<html>
  <head></head>
  <body>

    <style>
    .center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      padding: 0.5rem;
      display: flex;
      flex-flow: row wrap;
      justify-content: space-around;
      background-color: rgba(0,0,0,0.1);
    }
    #layerName{
      width: 8rem;
    }
    </style>
    <nav>
      <input type="file" id="loader" name="loader" />
      <button onclick="prev()">back</button>
      <button onclick="next()">next</button>
      <span id="layerName"></span>
      <div name="slideCounter">
        <span id="currentLayerIndex"></span>/<span id="slideCount"></span>
      </div>
    </nav>
    <output id="preSvg" class="center"></output>

    <script>
    var layers = [];
    var currentLayerIndex;
    var slideCount;

    // SERVICE FUNCTIONS
    function hideCurrentLayer () {
      layers[currentLayerIndex].style.display = 'none'
    }
    function showCurrentLayer () {
      layers[currentLayerIndex].style.display = 'inline'
    }
    function setCurrentLayer (indexOrKeyword) {
      if (typeof indexOrKeyword == 'number') {
        currentLayerIndex = indexOrKeyword
      } else {
        switch (indexOrKeyword) {
          case 'next':
            currentLayerIndex == layers.length - 1 ? currentLayerIndex = 0 : currentLayerIndex++
            break;
          case 'prev':
            currentLayerIndex == 0 ? currentLayerIndex = layers.length - 1 : currentLayerIndex--
            break;
          default:
        }
      }
      var name = layers[currentLayerIndex].attributes['inkscape:label'].value;
      document.querySelector('#layerName').innerHTML = name
      document.querySelector('#currentLayerIndex').innerHTML = currentLayerIndex + 1
    }
    function setBackgroundColor () {
      var bodyNode = document.querySelector('body')
      var pageSettingsNode = document.querySelector('[pagecolor]')
      bodyNode.style.backgroundColor = pageSettingsNode.getAttribute('pagecolor')
    }
    function handleFileSelect(evt) {
      //https://www.html5rocks.com/de/tutorials/file/dndfiles/
      var file = evt.target.files[0]; // FileList object

      // Only process image files.
      if (!file.type.match('image.*')) {
        console.error('only accept image files');
        return;
      }

      var reader = new FileReader();

      // Closure to capture the file information.
      reader.onload = (function(theFile) {
        return function(event) {
          document.getElementById('preSvg').innerHTML = event.target.result;
          setupPresentation();
        };
      })(file);

      // Read in the image file as plain text.
      reader.readAsText(file);
      // Remove focus from input button
      document.querySelector('#loader').blur()
    }
    function handleKeyEvent (event) {
      switch (event.key) {
        case 'Backspace':
          prev()
          break;
        case 'ArrowLeft':
          prev()
          break;
        case 'ArrowUp':
          prev()
          break;
        case 'ArrowRight':
          next()
          break;
        case 'ArrowDown':
          next()
          break;
        case ' ':
          next()
          break;
        case 'Enter':
          next()
          break;
        default:
      }
    }

    // CONTROLLER FUNCTIONS
    var setupPresentation = function () {
      //requires svg file to be inserted
      setBackgroundColor()
      layers = document.querySelectorAll('g[inkscape\\:groupmode=layer]')
      slideCount = layers.length
      document.querySelector('#slideCount').innerHTML = slideCount
      //hide all layers
      layers.forEach(function(layer){
        layer.style.display = 'none';
      })
      //set first layer as currentLayer
      setCurrentLayer(0);
      showCurrentLayer()
    }
    var prev = function () {
      hideCurrentLayer()
      setCurrentLayer('prev')
      showCurrentLayer()
    }
    var next = function () {
      hideCurrentLayer()
      setCurrentLayer('next')
      showCurrentLayer()
    }

    // INIT
    document.getElementById('loader').addEventListener('change', handleFileSelect, false)
    document.onkeydown = handleKeyEvent
    if (document.querySelector('output svg')) {
      setupPresentation()
    }
    </script>
  </body>
</html>
